# Malware 1/3 - 100 pts

aka Démonstration de la puissance de `grep` :slightly_smiling_face:

> *Ce challenge est un challenge en 3 parties indépendantes, mais dont l'ordre logique est indiqué par les numéros : forensics (1)  -> pwn (2) -> reverse (3).* 
>
> **/!\ L'image mémoire ci-jointe contient un programme qui a la capacité de chiffrer le fichier** `/home/%USER%/Desktop/flag.txt` **/!\\** 
>
> Oh non ! Votre précieux fichier `flag.txt` présent sur  votre bureau semble avoir été chiffré par un programme malveillant...  Votre premier réflexe a été d'effectuer une capture mémoire, peut être  que le malware tourne encore... 
>
> Le flag est au format `FCSC{sha256(username:hostname:cmdline)}`, où `username` est le nom de l'utilisateur ayant exécuté le malware, `hostname` est le nom de la machine sur laquelle celui-ci a été exécuté et  `cmdline` est la ligne de commande complète qui a été exécutée afin de lancer le programme malveillant. 
>
> `snapshot.sav.7z` (149MB) : https://files.france-cybersecurity-challenge.fr/dl/malware/snapshot.sav.7z 
>
> SHA256(`snapshot.sav`) = `7eab73f5526ea0ac19edddc350155410ff4c77a15ac93f1c908b81884ef016a8`.

Après avoir passé trop de temps à essayer de monter une VM avec le même kernel, je me suis dit que j'allais y aller à grand coup de `strings` et `grep`.

Pour le nom d'utilisateur :

```
$ strings snapshot.sav | grep /home/
/home/forensics/.cache
/home/forensics/.cache/tracker
/home/forensics/.local/share/icons/Yaru
/home/forensics/.icons/Yaru
/home/forensics/.local/share/icons
file:///home/forensics/Vid%C3%A9os
[...]
```

C'est sans doute `forensics`.



Pour l'hostname :

```
$ strings snapshot.sav | grep forensics@
[...]
0;forensics@fcsc2021: ~/Bureau
[01;32mforensics@fcsc2021
forensics@fcsc2021: ~/Bureau
forensics@fcsc2021:~/Bureau$  /bin/1 --client -i 192.168.56.103
forensics@fcsc2021: ~/Bureau
forensics@fcsc2021: ~/Bureau
[...]

```

C'est `fcsc2021` et on a même trouvé la commande malveillante : `/bin/1 --client -i 192.168.56.103`.



```
$ echo -n "forensics:fcsc2021:/bin/1 --client -i 192.168.56.103" | sha256sum
34aa0f2895fc61bdfb26c47708d78c6b99db30dddaecaa93cf5a4ab5acb76923  -
```

(on oublie pas le `-n` sinon `echo` fait un saut de ligne et le sha256 est différent)

```
FCSC{34aa0f2895fc61bdfb26c47708d78c6b99db30dddaecaa93cf5a4ab5acb76923}
```